# toolchain/gcc-sh4/toolchain-template.cmake.in
# CMake Toolchain File for Sega Dreamcast (SH4)
# Generated by GCC SH4 Toolchain Build System

set(CMAKE_SYSTEM_NAME Generic)
set(CMAKE_SYSTEM_PROCESSOR sh4)

# Toolchain paths
set(TOOLCHAIN_PREFIX @INSTALL_PREFIX@)
set(CMAKE_C_COMPILER ${TOOLCHAIN_PREFIX}/bin/sh-elf-gcc)
set(CMAKE_CXX_COMPILER ${TOOLCHAIN_PREFIX}/bin/sh-elf-g++)
set(CMAKE_ASM_COMPILER ${TOOLCHAIN_PREFIX}/bin/sh-elf-as)
set(CMAKE_AR ${TOOLCHAIN_PREFIX}/bin/sh-elf-ar)
set(CMAKE_LINKER ${TOOLCHAIN_PREFIX}/bin/sh-elf-ld)
set(CMAKE_NM ${TOOLCHAIN_PREFIX}/bin/sh-elf-nm)
set(CMAKE_OBJCOPY ${TOOLCHAIN_PREFIX}/bin/sh-elf-objcopy)
set(CMAKE_OBJDUMP ${TOOLCHAIN_PREFIX}/bin/sh-elf-objdump)
set(CMAKE_RANLIB ${TOOLCHAIN_PREFIX}/bin/sh-elf-ranlib)
set(CMAKE_SIZE ${TOOLCHAIN_PREFIX}/bin/sh-elf-size)
set(CMAKE_STRIP ${TOOLCHAIN_PREFIX}/bin/sh-elf-strip)

# Dreamcast SH4 specific flags
set(DREAMCAST_ARCH_FLAGS "-m4-single-only -ml")
set(DREAMCAST_COMMON_FLAGS "-O2 -fomit-frame-pointer -ffunction-sections -fdata-sections")

# C flags
set(CMAKE_C_FLAGS_INIT "${DREAMCAST_ARCH_FLAGS} ${DREAMCAST_COMMON_FLAGS}")
set(CMAKE_C_FLAGS_DEBUG_INIT "-g -O0")
set(CMAKE_C_FLAGS_RELEASE_INIT "-O3 -DNDEBUG")

# C++ flags
set(CMAKE_CXX_FLAGS_INIT "${DREAMCAST_ARCH_FLAGS} ${DREAMCAST_COMMON_FLAGS} -fno-exceptions -fno-rtti")
set(CMAKE_CXX_FLAGS_DEBUG_INIT "-g -O0")
set(CMAKE_CXX_FLAGS_RELEASE_INIT "-O3 -DNDEBUG")

# Linker flags
set(CMAKE_EXE_LINKER_FLAGS_INIT "${DREAMCAST_ARCH_FLAGS} -Wl,--gc-sections -nostartfiles")

# Search paths
set(CMAKE_FIND_ROOT_PATH ${TOOLCHAIN_PREFIX}/sh-elf)
set(CMAKE_FIND_ROOT_PATH_MODE_PROGRAM NEVER)
set(CMAKE_FIND_ROOT_PATH_MODE_LIBRARY ONLY)
set(CMAKE_FIND_ROOT_PATH_MODE_INCLUDE ONLY)

# Target properties
set(CMAKE_EXECUTABLE_SUFFIX_C ".elf")
set(CMAKE_EXECUTABLE_SUFFIX_CXX ".elf")

# KallistiOS integration (optional)
set(KOS_BASE "@KALLISTIOS_PREFIX@" CACHE PATH "KallistiOS base directory")
if(EXISTS ${KOS_BASE}/include)
    include_directories(${KOS_BASE}/include)
    link_directories(${KOS_BASE}/lib)
    message(STATUS "KallistiOS found at ${KOS_BASE}")
endif()

message(STATUS "Dreamcast SH4 toolchain loaded from ${TOOLCHAIN_PREFIX}")